<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>leprNotes - leaperStuff</title>
    <style>
        /* CSS Variables for Color Palette */
        :root {
          --color1: #FFD166; /* Yellow */
          --color2: #FFA62E; /* Orange-Yellow */
          --color3: #FF8E00; /* Dark Yellow */
          --color4: #118AB2; /* Blue */
          --color5: #073B4C; /* Dark Blue */
          --text-light: #ffffff;
          --text-dark: #333333;
          --shadow: rgba(0, 0, 0, 0.1);
          --shadow-dark: rgba(0, 0, 0, 0.2);
        }

        /* Reset and Base Styles */
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: #1a1a2e; /* Solid dark background instead of gradient */
          min-height: 100vh;
          color: var(--text-light);
          line-height: 1.6;
        }

        /* Glassmorphism Base Mixin */
        .glass {
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border: 1px solid rgba(255, 255, 255, 0.2);
          border-radius: 16px;
        }

        /* Liquid Glass Effect */
        .liquid-glass {
          background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.2) 0%,
            rgba(255, 255, 255, 0.1) 50%,
            rgba(255, 255, 255, 0.05) 100%
          );
          backdrop-filter: blur(25px);
          -webkit-backdrop-filter: blur(25px);
          border: 1px solid rgba(255, 255, 255, 0.3);
          border-radius: 20px;
          box-shadow: 
            0 8px 32px var(--shadow),
            inset 0 1px 0 rgba(255, 255, 255, 0.4),
            inset 0 -1px 0 rgba(0, 0, 0, 0.1);
          position: relative;
          overflow: hidden;
        }

        .liquid-glass::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
          );
          transition: left 0.6s ease;
        }

        .liquid-glass:hover::before {
          left: 100%;
        }

        /* Sticky Navbar with Background */
        .navbar {
          position: sticky;
          top: 0;
          z-index: 1000;
          padding: 1rem 2rem;
          margin-bottom: 2rem;
          background: rgba(26, 26, 46, 0.95); /* Solid background with slight transparency */
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .navbar.hidden {
          transform: translateY(-100%);
          opacity: 0;
        }

        .navbar-container {
          display: flex;
          justify-content: space-between;
          align-items: center;
          max-width: 1200px;
          margin: 0 auto;
        }

        .navbar-brand {
          font-size: 1.5rem;
          font-weight: bold;
          color: var(--text-light);
          text-decoration: none;
        }

        .navbar-nav {
          display: flex;
          list-style: none;
          gap: 2rem;
        }

        .navbar-nav a {
          color: var(--text-light);
          text-decoration: none;
          padding: 0.5rem 1rem;
          border-radius: 8px;
          transition: all 0.3s ease;
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
        }

        .navbar-nav a:hover {
          background: rgba(255, 255, 255, 0.2);
          transform: translateY(-2px);
        }

        /* Buttons */
        .btn {
          padding: 0.75rem 1.5rem;
          border: none;
          border-radius: 12px;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          text-decoration: none;
          display: inline-block;
          text-align: center;
          margin: 5px;
        }

        .btn-primary {
          background: linear-gradient(135deg, var(--color1), var(--color2));
          color: var(--color5);
        }

        .btn-secondary {
          background: var(--color4); /* Solid blue instead of gradient */
          color: var(--text-light);
        }

        .btn:hover {
          transform: translateY(-3px);
          box-shadow: 
            0 12px 40px var(--shadow-dark),
            inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .btn:active {
          transform: translateY(-1px);
        }

        /* Cards */
        .card {
          padding: 2rem;
          margin: 1rem;
          transition: all 0.3s ease;
          border-radius: 12px;
        }

        .card:hover {
          transform: translateY(-5px);
          box-shadow: 
            0 15px 40px var(--shadow-dark),
            inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .card-header {
          margin-bottom: 1rem;
          padding-bottom: 1rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-title {
          font-size: 1.25rem;
          font-weight: bold;
          margin-bottom: 0.5rem;
        }

        /* Forms - Updated with dark yellow background and white text */
        .form-group {
          margin-bottom: 1.5rem;
        }

        .form-label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 600;
        }

        .form-control {
          width: 100%;
          padding: 0.75rem 1rem;
          border: none;
          border-radius: 12px;
          font-size: 1rem;
          background: var(--color5); /* Dark yellow background */
          color: var(--text-light); /* White text */
          transition: all 0.3s ease;
          border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-control:focus {
          outline: none;
          box-shadow: 
            0 0 0 3px rgba(255, 209, 102, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.4);
          background: var(--color4); /* Lighter yellow on focus */
        }

        .form-control::placeholder {
          color: rgba(255, 255, 255, 0.8); /* Light placeholder text */
        }

        /* Textarea specific styles */
        textarea.form-control {
          resize: vertical;
          min-height: 100px;
        }

        /* Tables */
        .table-container {
          padding: 1.5rem;
          margin: 1rem;
          overflow-x: auto;
        }

        .table {
          width: 100%;
          border-collapse: collapse;
          background: rgba(255, 255, 255, 0.05);
          border-radius: 12px;
          overflow: hidden;
        }

        .table th,
        .table td {
          padding: 1rem;
          text-align: left;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table th {
          background: rgba(255, 255, 255, 0.1);
          font-weight: 600;
          color: var(--color1);
        }

        .table tr:hover {
          background: rgba(255, 255, 255, 0.05);
        }

        .table tr:last-child td {
          border-bottom: none;
        }

        /* Alerts */
        .alert {
          padding: 1rem 1.5rem;
          margin: 1rem;
          border-radius: 12px;
        }

        .alert-success {
          background: linear-gradient(135deg, rgba(17, 138, 178, 0.3), rgba(7, 59, 76, 0.3));
          border-left: 4px solid var(--color4);
        }

        .alert-warning {
          background: linear-gradient(135deg, rgba(255, 209, 102, 0.3), rgba(255, 142, 0, 0.3));
          border-left: 4px solid var(--color1);
        }

        .alert-error {
          background: linear-gradient(135deg, rgba(239, 71, 111, 0.3), rgba(255, 0, 0, 0.3));
          border-left: 4px solid #EF476F;
        }

        /* Progress Bars */
        .progress {
          width: 100%;
          height: 8px;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 4px;
          overflow: hidden;
        }

        .progress-bar {
          height: 100%;
          background: linear-gradient(90deg, var(--color1), var(--color2));
          border-radius: 4px;
          transition: width 0.4s ease;
          position: relative;
          overflow: hidden;
        }

        .progress-bar::after {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.4),
            transparent
          );
          animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
          0% { left: -100%; }
          100% { left: 100%; }
        }

        /* Badges */
        .badge {
          display: inline-block;
          padding: 0.25rem 0.75rem;
          font-size: 0.75rem;
          font-weight: 600;
          border-radius: 20px;
        }

        .badge-primary {
          background: linear-gradient(135deg, var(--color1), var(--color2));
          color: var(--color5);
        }

        .badge-secondary {
          background: var(--color4); /* Solid blue instead of gradient */
          color: var(--text-light);
        }

        /* Modal */
        .modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 2000;
          backdrop-filter: blur(10px);
        }

        .modal.hidden {
          display: none !important;
        }

        .modal-content {
          padding: 2rem;
          max-width: 500px;
          width: 90%;
          max-height: 80vh;
          overflow-y: auto;
          background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.2) 0%,
            rgba(255, 255, 255, 0.1) 50%,
            rgba(255, 255, 255, 0.05) 100%
          );
          backdrop-filter: blur(25px);
          -webkit-backdrop-filter: blur(25px);
          border: 1px solid rgba(255, 255, 255, 0.3);
          border-radius: 20px;
          box-shadow: 
            0 8px 32px var(--shadow),
            inset 0 1px 0 rgba(255, 255, 255, 0.4),
            inset 0 -1px 0 rgba(0, 0, 0, 0.1);
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          padding-bottom: 1rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-close {
          background: none;
          border: none;
          font-size: 1.5rem;
          color: var(--text-light);
          cursor: pointer;
          padding: 0.25rem;
          border-radius: 8px;
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }

        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .p-3 { padding: 1.5rem; }

        .d-flex { display: flex; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }

        /* Container for rounded corners demo */
        .demo-container {
          padding: 2rem;
          margin: 2rem 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
          .navbar-container {
            flex-direction: column;
            gap: 1rem;
          }
          
          .navbar-nav {
            gap: 1rem;
          }
          
          .card {
            padding: 1.5rem;
            margin: 0.5rem;
          }
          
          .btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
          }
        }
        @media (min-width: 768px) {.navbar-brand {margin-right: 15px;}}

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
          width: 8px;
        }

        ::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
          background: linear-gradient(var(--color1), var(--color2));
          border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(var(--color2), var(--color3));
        }

        /* ------------- ToolTip ----------- */
        .tip {
          position: relative;
          cursor: pointer;
        }

        .tip::after {
          content: attr(tooltip);
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background: rgba(255, 255, 255, 0.15);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border: 1px solid rgba(255, 255, 255, 0.3);
          color: var(--text-light);
          padding: 2px 3px;
          font-size: 12px;
          white-space: nowrap;
          opacity: 0;
          visibility: hidden;
          transition: all 0.3s ease;
          z-index: 1000;
          pointer-events: none;
          border-radius: 8px;
          box-shadow: 0 8px 32px var(--shadow);
          margin-bottom: 8px;
        }

        .tip:hover::after,
        .tip:hover::before {
          opacity: 1;
          visibility: visible;
        }

        .tip.tip-bottom::after {
          top: 100%;
          bottom: auto;
          margin-top: 8px;
          margin-bottom: 0;
        }

        .tip.tip-bottom::before {
          top: 100%;
          bottom: auto;
          border-top-color: transparent;
          border-bottom-color: rgba(255, 255, 255, 0.3);
          margin-top: -4px;
          margin-bottom: 0;
        }

        /* Tooltip color variations */
        .tip.tip-primary::after {
          background: linear-gradient(135deg, var(--color1), var(--color2));
          color: var(--color5);
          border: 1px solid rgba(255, 209, 102, 0.4);
        }

        .tip.tip-primary::before {
          border-top-color: var(--color1);
        }

        .tip.tip-primary.tip-bottom::before {
          border-bottom-color: var(--color1);
          border-top-color: transparent;
        }

        .tip.tip-secondary::after {
          background: var(--color4);
          color: var(--text-light);
          border: 1px solid rgba(17, 138, 178, 0.4);
        }

        .tip.tip-secondary::before {
          border-top-color: var(--color4);
        }

        .tip.tip-secondary.tip-bottom::before {
          border-bottom-color: var(--color4);
          border-top-color: transparent;
        }

            /* Responsive */
            @media (max-width: 768px) {
              nav {
                flex-direction: column;
                text-align: center;
              }
              
              .features {
                grid-template-columns: 1fr;
              }
              
              .contact-links {
                flex-direction: column;
                align-items: center;
              }
            }

                /* Footer */
            footer {
              text-align: center;
              margin-top: 4rem;
              padding: 2rem 0;
              border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

        /* App Specific Styles */
        .app-container {
            display: flex;
            min-height: calc(100vh - 100px);
            margin: 10%;
            transition: margin 0.3s ease;
        }

        @media (max-width: 768px) {
            .app-container {
                margin: 2%;
            }
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            margin-right: 20px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 0px !important;
            opacity: 0%;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            margin-right: 10px;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
        }

        .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .notes-list {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }

        .note-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .note-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .note-item.active {
            background: rgba(255, 209, 102, 0.2);
            border-left: 3px solid var(--color1);
        }

        .note-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .note-item-title {
            font-weight: bold;
            margin: 0;
        }

        .note-actions-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
        }

        .note-item-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 8px;
        }

        .tag {
            background: var(--color4);
            color: var(--text-light);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .note-item-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .mode-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 20px;
        }

        .mode-panel.hidden {
            display: none !important;
        }

        .split-view {
            display: flex;
            gap: 20px;
        }

        .split-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .note-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .note-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--color1);
        }

        .note-title.editable {
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .note-title.editable:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .note-title[contenteditable="true"] {
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }

        .editor {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-light);
            font-family: monospace;
            font-size: 1rem;
            line-height: 1.5;
            resize: none;
            outline: none;
        }

        .preview {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .preview h1, .preview h2, .preview h3 {
            color: var(--color1);
            margin-bottom: 15px;
        }

        .preview p {
            margin-bottom: 15px;
        }

        .preview code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
        }

        .preview pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 15px;
        }

        .preview blockquote {
            border-left: 3px solid var(--color4);
            padding-left: 15px;
            margin-left: 0;
            color: rgba(255, 255, 255, 0.8);
        }

        .live-editor {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-light);
            font-family: monospace;
            font-size: 1rem;
            line-height: 1.5;
            overflow-y: auto;
            outline: none;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mode-select {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-light);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 5px 0;
            min-width: 150px;
            box-shadow: 0 8px 32px var(--shadow);
            z-index: 100;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu button {
            width: 100%;
            padding: 8px 15px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            color: var(--text-light);
        }

        .dropdown-menu button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .save-indicator {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1001;
            box-shadow: 0 8px 32px var(--shadow);
        }

        .toast.hidden {
            display: none !important;
        }

        .modal-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-danger {
            background: linear-gradient(135deg, #EF476F, #FF0A54);
            color: var(--text-light);
        }

        #versionList {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
        }

        .version-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .version-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .version-item:last-child {
            border-bottom: none;
        }

        .version-item.active {
            background: rgba(255, 209, 102, 0.2);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <nav id="navbar" class="navbar">
        <div class="nav-brand">leprNotes — leaperStuff</div>
        <div class="nav-controls">
                          <button id="sidebarToggle" class="sidebar-toggle">☰</button>
            <select id="modeSelect" class="mode-select">
                <option value="preview">Preview</option>
                <option value="editing" selected>Editing</option>
                <option value="both">Both (Desktop)</option>
                <option value="live">Live Preview (Beta)</option>
            </select>
            <div class="dropdown">
                <button class="dropdown-toggle" id="fileActionsBtn">⋯</button>
                <div class="dropdown-menu">
                    <button id="renameBtn">Rename</button>
                    <button id="duplicateBtn">Duplicate</button>
                    <button id="versionHistoryBtn">Version History</button>
                    <button id="deleteBtn">Delete</button>
                    <button id="exportMDBtn">Export (MD)</button>
                    <button id="exportJSONBtn">Export (JSON)</button>
                </div>
            </div>
            <div id="saveIndicator" class="save-indicator">Saved</div>
        </div>
    </nav>

    <div class="app-container">
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">

                <input type="text" id="searchNotes" placeholder="Search notes..." class="search-input">
            </div>
            <div class="sidebar-actions">
                <button id="newNoteBtn" class="btn btn-primary">New Note</button>
                <button id="newFolderBtn" class="btn btn-secondary">New Folder</button>
                <button id="newTagBtn" class="btn btn-secondary">New Tag</button>
            </div>
            <div id="notesList" class="notes-list">
                <!-- Notes will be populated here -->
            </div>
        </aside>

        <main class="editor-area">
            <div id="editingMode" class="mode-panel">
                <div class="note-header">
                    <h1 id="noteTitle" class="note-title editable" contenteditable="false">Untitled</h1>
                    <div id="noteTags" class="note-tags"></div>
                </div>
                <textarea id="editor" class="editor" placeholder="Start writing your markdown..."></textarea>
            </div>

            <div id="previewMode" class="mode-panel hidden">
                <div class="note-header">
                    <h1 id="previewTitle" class="note-title">Untitled</h1>
                    <div id="previewTags" class="note-tags"></div>
                </div>
                <div id="preview" class="preview"></div>
            </div>

            <div id="bothMode" class="mode-panel split-view hidden">
                <div class="split-panel">
                    <div class="note-header">
                        <h1 id="bothTitle" class="note-title editable" contenteditable="false">Untitled</h1>
                        <div id="bothTags" class="note-tags"></div>
                    </div>
                    <textarea id="editorBoth" class="editor" placeholder="Start writing your markdown..."></textarea>
                </div>
                <div class="split-panel">
                    <div class="note-header">
                        <h1 id="bothPreviewTitle" class="note-title">Untitled</h1>
                        <div id="bothPreviewTags" class="note-tags"></div>
                    </div>
                    <div id="previewBoth" class="preview"></div>
                </div>
            </div>

            <div id="liveMode" class="mode-panel hidden">
                <div class="note-header">
                    <h1 id="liveTitle" class="note-title editable" contenteditable="false">Untitled</h1>
                    <div id="liveTags" class="note-tags"></div>
                </div>
                <div id="liveEditor" class="live-editor" contenteditable="true"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <h3>Delete Note</h3>
            <p>Are you sure you want to delete this note?</p>
            <div class="modal-actions">
                <button id="confirmDelete" class="btn btn-danger">Delete</button>
                <button id="cancelDelete" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <div id="tagModal" class="modal hidden">
        <div class="modal-content">
            <h3>Edit Tags</h3>
            <div id="tagInputs"></div>
            <div class="modal-actions">
                <button id="saveTags" class="btn btn-primary">Save</button>
                <button id="cancelTags" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <div id="versionModal" class="modal hidden">
        <div class="modal-content">
            <h3>Version History</h3>
            <div id="versionList"></div>
            <div class="modal-actions">
                <button id="closeVersionModal" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>

    <script>
      // leprNotes by leaperStuff - Markdown Note-Taking App
class LeprNotes {
    constructor() {
        this.notes = [];
        this.currentNote = null;
        this.currentMode = 'editing';
        this.isSidebarCollapsed = false;
        this.autoSaveInterval = null;
        this.lastSaveTime = null;
        this.navbarTimeout = null;
        this.livePreviewTimeout = null;
        this.saveTimeout = null;
        
        this.init();
    }

    init() {
        this.loadNotes();
        this.setupEventListeners();
        this.setupAutoSave();
        this.applyResponsiveMargins();
        this.setupMarkdownParser();
        
        // Ensure all modals are hidden on startup
        this.hideAllModals();
        
        // Load first note or create default
        if (this.notes.length > 0) {
            this.loadNote(this.notes[0].id);
        } else {
            this.createNewNote();
        }
        
        // Add sample data if empty
        if (this.notes.length === 0) {
            this.createSampleNotes();
        }
        
        this.renderNotesList();
    }

    // Data Management
    loadNotes() {
        const stored = localStorage.getItem('leprNotes_v1_notes');
        if (stored) {
            this.notes = JSON.parse(stored);
        }
    }

    saveNotes() {
        try {
            localStorage.setItem('leprNotes_v1_notes', JSON.stringify(this.notes));
            this.updateSaveIndicator();
            return true;
        } catch (e) {
            this.showError('Storage full. Please export some notes to free space.');
            return false;
        }
    }

    // Note CRUD Operations
    createNewNote() {
        const note = {
            id: Date.now().toString(),
            title: 'Untitled',
            content: '',
            tags: [],
            folder: null,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            versions: []
        };
        
        this.notes.unshift(note);
        this.saveNotes();
        this.loadNote(note.id);
        this.renderNotesList();
        
        return note;
    }

    loadNote(noteId) {
        this.saveCurrentNote(); // Save current before switching
        
        const note = this.notes.find(n => n.id === noteId);
        if (note) {
            this.currentNote = note;
            this.updateEditorContent();
            this.updateNoteTitle();
            this.updateTagsDisplay();
            this.renderPreview();
            this.renderNotesList();
        }
    }

    saveCurrentNote() {
        if (!this.currentNote) return;
        
        const content = this.getEditorContent();
        if (content !== this.currentNote.content) {
            this.currentNote.content = content;
            this.currentNote.updatedAt = new Date().toISOString();
            
            // Add to version history (limit to 50 versions)
            this.currentNote.versions.unshift({
                timestamp: new Date().toISOString(),
                content: content
            });
            
            if (this.currentNote.versions.length > 50) {
                this.currentNote.versions = this.currentNote.versions.slice(0, 50);
            }
            
            this.saveNotes();
            this.renderNotesList();
        }
    }

    duplicateNote() {
        if (!this.currentNote) return;
        
        const duplicate = {
            ...this.currentNote,
            id: Date.now().toString(),
            title: `${this.currentNote.title} (Copy)`,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            versions: []
        };
        
        this.notes.unshift(duplicate);
        this.saveNotes();
        this.loadNote(duplicate.id);
        this.renderNotesList();
    }

    deleteNote() {
        if (!this.currentNote) return;
        
        const noteIndex = this.notes.findIndex(n => n.id === this.currentNote.id);
        if (noteIndex !== -1) {
            const deletedNote = this.notes.splice(noteIndex, 1)[0];
            this.saveNotes();
            
            // Store for potential undo
            localStorage.setItem('leprNotes_v1_lastDeleted', JSON.stringify(deletedNote));
            
            // Load next available note or create new
            if (this.notes.length > 0) {
                this.loadNote(this.notes[0].id);
            } else {
                this.createNewNote();
            }
            
            this.renderNotesList();
            this.showToast('Note deleted. <button id="undoDelete">Undo</button>', 5000);
            
            // Setup undo handler
            setTimeout(() => {
                const undoBtn = document.getElementById('undoDelete');
                if (undoBtn) {
                    undoBtn.onclick = () => this.undoDelete();
                }
            }, 100);
        }
    }

    undoDelete() {
        const deleted = localStorage.getItem('leprNotes_v1_lastDeleted');
        if (deleted) {
            const note = JSON.parse(deleted);
            this.notes.unshift(note);
            this.saveNotes();
            this.loadNote(note.id);
            this.renderNotesList();
            this.hideToast();
        }
    }

    // Editor & Preview
    getEditorContent() {
        switch (this.currentMode) {
            case 'editing':
                return document.getElementById('editor').value;
            case 'both':
                return document.getElementById('editorBoth').value;
            case 'live':
                return document.getElementById('liveEditor').innerText;
            default:
                return this.currentNote?.content || '';
        }
    }

    updateEditorContent() {
        if (!this.currentNote) return;
        
        const content = this.currentNote.content;
        document.getElementById('editor').value = content;
        document.getElementById('editorBoth').value = content;
        document.getElementById('liveEditor').innerText = content;
    }

    updateNoteTitle() {
        if (!this.currentNote) return;
        
        const title = this.currentNote.title;
        const titleElements = document.querySelectorAll('.note-title');
        titleElements.forEach(el => {
            if (!el.classList.contains('editable') || el.getAttribute('contenteditable') === 'false') {
                el.textContent = title;
            }
        });
    }

    updateTagsDisplay() {
        if (!this.currentNote) return;
        
        const tagsContainer = document.querySelectorAll('.note-tags');
        tagsContainer.forEach(container => {
            container.innerHTML = '';
            this.currentNote.tags.forEach(tag => {
                const tagEl = document.createElement('span');
                tagEl.className = 'tag';
                tagEl.textContent = tag;
                container.appendChild(tagEl);
            });
        });
    }

    setupMarkdownParser() {
        // Custom renderer for underline support
        const renderer = new marked.Renderer();
        const originalParagraph = renderer.paragraph;
        
        // Add underline support using __text__
        renderer.paragraph = (text) => {
            // Process __text__ for underline
            text = text.replace(/__([^_]+)__/g, '<u>$1</u>');
            return originalParagraph.call(renderer, text);
        };
        
        marked.setOptions({
            renderer: renderer,
            breaks: true,
            gfm: true,
            tables: true
        });
    }

    renderPreview() {
        if (!this.currentNote) return;
        
        const content = this.currentNote.content;
        try {
            const html = marked.parse(content);
            document.getElementById('preview').innerHTML = html;
            document.getElementById('previewBoth').innerHTML = html;
        } catch (e) {
            document.getElementById('preview').innerHTML = '<p>Error rendering markdown</p>';
            document.getElementById('previewBoth').innerHTML = '<p>Error rendering markdown</p>';
        }
    }

    renderLivePreview() {
        if (this.livePreviewTimeout) {
            clearTimeout(this.livePreviewTimeout);
        }
        
        this.livePreviewTimeout = setTimeout(() => {
            if (this.currentNote && this.currentMode === 'live') {
                const content = document.getElementById('liveEditor').innerText;
                try {
                    const html = marked.parse(content);
                    document.getElementById('liveEditor').innerHTML = html;
                } catch (e) {
                    document.getElementById('liveEditor').innerHTML = '<p>Error rendering markdown</p>';
                }
            }
        }, 200);
    }

    // UI Management
    switchMode(mode) {
        this.currentMode = mode;
        
        // Hide all panels
        document.querySelectorAll('.mode-panel').forEach(panel => {
            panel.classList.add('hidden');
        });
        
        // Show selected panel
        switch (mode) {
            case 'editing':
                document.getElementById('editingMode').classList.remove('hidden');
                break;
            case 'preview':
                document.getElementById('previewMode').classList.remove('hidden');
                this.renderPreview();
                break;
            case 'both':
                document.getElementById('bothMode').classList.remove('hidden');
                this.renderPreview();
                break;
            case 'live':
                document.getElementById('liveMode').classList.remove('hidden');
                this.renderLivePreview();
                break;
        }
        
        // Update selector
        document.getElementById('modeSelect').value = mode;
    }

    renderNotesList() {
        const container = document.getElementById('notesList');
        container.innerHTML = '';
        
        this.notes
            .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
            .forEach(note => {
                const noteEl = document.createElement('div');
                noteEl.className = `note-item ${note.id === this.currentNote?.id ? 'active' : ''}`;
                noteEl.innerHTML = `
                    <div class="note-item-header">
                        <h3 class="note-item-title">${this.escapeHtml(note.title)}</h3>
                        <button class="note-actions-btn">⋯</button>
                    </div>
                    <div class="note-item-tags">
                        ${note.tags.map(tag => `<span class="tag">${this.escapeHtml(tag)}</span>`).join('')}
                    </div>
                    <div class="note-item-date">${new Date(note.updatedAt).toLocaleDateString()}</div>
                `;
                
                noteEl.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('note-actions-btn')) {
                        this.loadNote(note.id);
                    }
                });
                
                // Note actions
                const actionsBtn = noteEl.querySelector('.note-actions-btn');
                actionsBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.showNoteActions(note, actionsBtn);
                });
                
                container.appendChild(noteEl);
            });
    }

    showNoteActions(note, button) {
        // Simple implementation - reuse navbar actions
        this.loadNote(note.id);
        document.getElementById('fileActionsBtn').click();
    }

    // Version History
    showVersionHistory() {
        if (!this.currentNote) return;
        
        const versionList = document.getElementById('versionList');
        versionList.innerHTML = '';
        
        // Add current version
        const currentVersion = document.createElement('div');
        currentVersion.className = 'version-item active';
        currentVersion.innerHTML = `
            <strong>Current Version</strong>
            <div>${new Date().toLocaleString()}</div>
        `;
        currentVersion.addEventListener('click', () => {
            this.restoreVersion(this.currentNote.content);
        });
        versionList.appendChild(currentVersion);
        
        // Add historical versions
        this.currentNote.versions.forEach((version, index) => {
            const versionEl = document.createElement('div');
            versionEl.className = 'version-item';
            versionEl.innerHTML = `
                <strong>Version ${index + 1}</strong>
                <div>${new Date(version.timestamp).toLocaleString()}</div>
            `;
            versionEl.addEventListener('click', () => {
                this.restoreVersion(version.content);
            });
            versionList.appendChild(versionEl);
        });
        
        this.showModal('versionModal');
    }

    restoreVersion(content) {
        if (!this.currentNote) return;
        
        this.currentNote.content = content;
        this.currentNote.updatedAt = new Date().toISOString();
        this.updateEditorContent();
        this.renderPreview();
        this.saveNotes();
        this.hideModal('versionModal');
        this.showToast('Version restored');
    }

    // Event Handlers
    setupEventListeners() {
        // Mode switching
        document.getElementById('modeSelect').addEventListener('change', (e) => {
            this.switchMode(e.target.value);
        });
        
        // Editor input
        document.getElementById('editor').addEventListener('input', () => {
            this.scheduleAutoSave();
        });
        
        document.getElementById('editorBoth').addEventListener('input', () => {
            this.scheduleAutoSave();
            this.renderPreview();
        });
        
        document.getElementById('liveEditor').addEventListener('input', () => {
            this.scheduleAutoSave();
            this.renderLivePreview();
        });
        
        // File actions
        document.getElementById('renameBtn').addEventListener('click', () => this.renameNote());
        document.getElementById('duplicateBtn').addEventListener('click', () => this.duplicateNote());
        document.getElementById('versionHistoryBtn').addEventListener('click', () => this.showVersionHistory());
        document.getElementById('deleteBtn').addEventListener('click', () => this.showDeleteModal());
        document.getElementById('exportMDBtn').addEventListener('click', () => this.exportAsMD());
        document.getElementById('exportJSONBtn').addEventListener('click', () => this.exportAsJSON());
        
        // Note title editing
        document.querySelectorAll('.note-title.editable').forEach(title => {
            title.addEventListener('click', () => {
                if (title.getAttribute('contenteditable') === 'false') {
                    title.setAttribute('contenteditable', 'true');
                    title.focus();
                    
                    // Select all text
                    const range = document.createRange();
                    range.selectNodeContents(title);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            });
            
            title.addEventListener('blur', () => {
                title.setAttribute('contenteditable', 'false');
                if (this.currentNote && title.textContent !== this.currentNote.title) {
                    this.currentNote.title = title.textContent;
                    this.currentNote.updatedAt = new Date().toISOString();
                    this.saveNotes();
                    this.renderNotesList();
                }
            });
            
            title.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    title.blur();
                }
            });
        });
        
        // New note button
        document.getElementById('newNoteBtn').addEventListener('click', () => {
            this.createNewNote();
        });
        
        // Search
        document.getElementById('searchNotes').addEventListener('input', (e) => {
            this.filterNotes(e.target.value);
        });
        
        // Sidebar toggle
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            this.toggleSidebar();
        });
        
        // Modals
        document.getElementById('confirmDelete').addEventListener('click', () => {
            this.deleteNote();
            this.hideModal('deleteModal');
        });
        
        document.getElementById('cancelDelete').addEventListener('click', () => {
            this.hideModal('deleteModal');
        });
        
        document.getElementById('closeVersionModal').addEventListener('click', () => {
            this.hideModal('versionModal');
        });
        
        // File actions dropdown
        document.getElementById('fileActionsBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            const menu = document.querySelector('.dropdown-menu');
            menu.classList.toggle('show');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('show');
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && !e.altKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        this.saveCurrentNote();
                        break;
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchNotes').focus();
                        break;
                    case 'k':
                        e.preventDefault();
                        this.insertLinkSyntax();
                        break;
                    case '/':
                        e.preventDefault();
                        this.togglePreview();
                        break;
                }
            }
            
            // Escape key
            if (e.key === 'Escape') {
                this.hideAllModals();
                document.querySelectorAll('.note-title[contenteditable="true"]').forEach(el => {
                    el.setAttribute('contenteditable', 'false');
                });
            }
        });
        
        // Navbar auto-hide
        document.addEventListener('mousemove', () => this.showNavbar());
        document.addEventListener('touchstart', () => this.showNavbar());
        document.addEventListener('focusin', (e) => {
            if (this.isMobile() && 
                (e.target.tagName === 'TEXTAREA' || e.target.getAttribute('contenteditable') === 'true')) {
                this.hideNavbar();
            }
        });
        
        // Responsive layout
        window.addEventListener('resize', () => {
            this.applyResponsiveMargins();
        });
    }

    // UI Utilities
    applyResponsiveMargins() {
        const container = document.querySelector('.app-container');
        if (window.innerWidth < 768) {
            container.style.margin = '2%';
        } else {
            container.style.margin = '10%';
        }
    }

    showNavbar() {
        const navbar = document.getElementById('navbar');
        navbar.classList.remove('hidden');
        
        if (this.navbarTimeout) {
            clearTimeout(this.navbarTimeout);
        }
        
        this.navbarTimeout = setTimeout(() => {
            if (!this.isMobile()) {
                navbar.classList.add('hidden');
            }
        }, 2000);
    }

    hideNavbar() {
        if (this.isMobile()) {
            document.getElementById('navbar').classList.add('hidden');
        }
    }

    isMobile() {
        return window.innerWidth < 768;
    }

    toggleSidebar() {
        this.isSidebarCollapsed = !this.isSidebarCollapsed;
        document.getElementById('sidebar').classList.toggle('collapsed');
    }

    showDeleteModal() {
        this.showModal('deleteModal');
    }

    showModal(modalId) {
        document.getElementById(modalId).classList.remove('hidden');
    }

    hideModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    hideAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.classList.add('hidden');
        });
    }

    showToast(message, duration = 3000) {
        const toast = document.getElementById('toast');
        toast.innerHTML = message;
        toast.classList.remove('hidden');
        
        setTimeout(() => {
            this.hideToast();
        }, duration);
    }

    hideToast() {
        document.getElementById('toast').classList.add('hidden');
    }

    updateSaveIndicator() {
        const indicator = document.getElementById('saveIndicator');
        this.lastSaveTime = new Date();
        indicator.textContent = `Saved ${this.lastSaveTime.toLocaleTimeString()}`;
    }

    // Auto-save functionality
    setupAutoSave() {
        this.autoSaveInterval = setInterval(() => {
            this.saveCurrentNote();
        }, 60000); // 60 seconds
    }

    scheduleAutoSave() {
        // Debounced save for frequent edits
        if (this.saveTimeout) {
            clearTimeout(this.saveTimeout);
        }
        this.saveTimeout = setTimeout(() => {
            this.saveCurrentNote();
        }, 1000);
    }

    // Export functionality
    exportAsMD() {
        if (!this.currentNote) return;
        
        const content = `# ${this.currentNote.title}\n\n${this.currentNote.content}`;
        this.downloadFile(`${this.currentNote.title}.md`, content, 'text/markdown');
    }

    exportAsJSON() {
        const data = {
            exportedAt: new Date().toISOString(),
            notes: this.notes
        };
        
        this.downloadFile('leprNotes_export.json', JSON.stringify(data, null, 2), 'application/json');
    }

    downloadFile(filename, content, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Additional features
    renameNote() {
        const title = document.querySelector('.note-title.editable');
        if (title) {
            title.setAttribute('contenteditable', 'true');
            title.focus();
            
            const range = document.createRange();
            range.selectNodeContents(title);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    insertLinkSyntax() {
        const editor = document.getElementById('editor');
        if (editor) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            const linkText = selectedText || 'link text';
            const newText = `[${linkText}](url)`;
            
            editor.setRangeText(newText, start, end, 'select');
            editor.focus();
        }
    }

    togglePreview() {
        const currentMode = this.currentMode;
        if (currentMode === 'editing') {
            this.switchMode('preview');
        } else if (currentMode === 'preview') {
            this.switchMode('editing');
        }
    }

    filterNotes(query) {
        const notes = document.querySelectorAll('.note-item');
        notes.forEach(note => {
            const title = note.querySelector('.note-item-title').textContent.toLowerCase();
            const tags = Array.from(note.querySelectorAll('.tag')).map(tag => tag.textContent.toLowerCase());
            
            const matches = title.includes(query.toLowerCase()) || 
                           tags.some(tag => tag.includes(query.toLowerCase()));
            
            note.style.display = matches ? 'block' : 'none';
        });
    }

    // Utility functions
    escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    showError(message) {
        alert(`Error: ${message}`);
    }

    // Sample data for first-time users
    createSampleNotes() {
        const sampleNotes = [
            {
                id: 'sample1',
                title: 'Welcome to leprNotes',
                content: `# Welcome to leprNotes!

This is a **markdown-first** note-taking app with:

## Features
- __Underline support__ with double underscores
- *Italic* and **bold** text
- \`inline code\`
- Lists (ordered and unordered)
- [Links](https://example.com)
- Tables
- Code blocks

\`\`\`javascript
// Example code block
function hello() {
    console.log("Hello, leprNotes!");
}
\`\`\`

> This is a blockquote

Enjoy using leprNotes!`,
                tags: ['welcome', 'getting-started'],
                folder: null,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                versions: []
            },
            {
                id: 'sample2',
                title: 'Markdown Cheatsheet',
                content: `# Markdown Cheatsheet

## Text Formatting
- **Bold**: \`**text**\` or \`__text__\`
- *Italic*: \`*text*\` or \`_text_\`
- __Underline__: \`__text__\` (custom extension)
- ~~Strikethrough~~: \`~~text~~\`
- \`Inline code\`: \\\`code\\\`

## Lists
- Unordered list: \`- item\`
- Ordered list: \`1. item\`
- [ ] Task list: \`- [ ] task\`

## Other Elements
> Blockquote: \`> text\`

\`\`\`
Code block with triple backticks
\`\`\`

[Link](url): \`[text](url)\`

![Image](alt): \`![alt](url)\`

---

Horizontal rule: \`---\``,
                tags: ['reference', 'markdown'],
                folder: null,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                versions: []
            }
        ];
        
        this.notes = sampleNotes;
        this.saveNotes();
    }
}

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.leprNotes = new LeprNotes();
});
    </script>
</body>
</html>